<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

<head>
    <title>User Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>
<body>
<div th:replace="~{partials/navbar :: navbar}"></div>
<h1>User Profile</h1>
<!-- display details about the current user -->
<h3 th:text="${user.username} ?: 'No username'"></h3>
<p th:text="${user.email} ?: 'No email'"></p>
<p th:text="${user.dietaryPreferences} ?: 'No dietary preferences'"></p>
<p th:text="${user.allergyList} ?: 'No allergies'"></p>
<p th:text="${user.otherAllergies} ?: 'No other allergies'"></p>

<!-- Link to create a new recipe -->
<a th:href="@{/recipes/new}" sec:authorize="isAuthenticated()">Create Recipe</a>

<!-- Link to favorites page -->
<a th:href="@{/favorites}" sec:authorize="isAuthenticated()">Favorites</a>


<!-- Display the saved recipe details, if available -->
<div th:if="${savedRecipe}">
    <h2>Saved Recipe Details:</h2>
    <p>Title: <span th:text="${savedRecipe.title} ?: 'No title'"></span></p>
</div>
<div>
    <h3>Have a nice restaurant experience? Tell everyone a little about it!</h3>
    <div sec:authorize="isAuthenticated()" class="nav-item">
        <a th:classappend="${selectedPage == 'posts-create'} ? active" class="nav-link" href="/posts/create" style="padding-right: 0.5rem; padding-left: 0.5rem;">Create Blog Post</a>
        &nbsp;
    </div>
</div>

<ul th:if="${mealPlanners}">
    <h2>Meal Planner</h2>
    <li th:each="mealPlanner : ${mealPlanners}">
        <span th:text="${mealPlanner.date} ?: 'No date'"></span>:
        <span th:text="${mealPlanner.recipe.title} ?: 'No recipe title'"></span>
    </li>
</ul>

<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editPreferencesModal">
    Edit Preferences
</button>

<!-- The Modal -->
<div class="modal" id="editPreferencesModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Edit Preferences</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <form th:action="@{/profile/edit}" method="POST" th:object="${user}">
                    <div class="form-group">
                        <label for="dietaryPreferences">Dietary Preferences:</label>
                        <input type="text" id="dietaryPreferences" th:field="*{dietaryPreferences}" class="form-control"/>
                    </div>
                    <div class="form-group">
                        <label for="allergyList">Allergies:</label>
                        <div id="allergyList">
                            <div th:each="allergy : ${allAllergies}" class="form-check">
                                <input class="form-check-input" type="checkbox" th:value="${allergy}" th:id="${allergy}" th:field="*{allergyList}">
                                <label class="form-check-label" th:for="${allergy}" th:text="${allergy}"></label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="otherAllergies">Other Allergies:</label>
                        <input type="text" id="otherAllergies" th:field="*{otherAllergies}" class="form-control"/>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

<div th:replace="~{partials/footer :: footer}"></div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


<div th:replace="partials/footer :: footer"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

</body>
</html>
